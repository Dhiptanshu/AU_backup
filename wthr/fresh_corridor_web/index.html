<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fresh Corridor Nexus | Smart Urban Logistics</title>

    <!-- CesiumJS -->
    <script src="https://cesium.com/downloads/cesiumjs/releases/1.113/Build/Cesium/Cesium.js"></script>
    <link href="https://cesium.com/downloads/cesiumjs/releases/1.113/Build/Cesium/Widgets/widgets.css" rel="stylesheet">

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- Custom CSS -->
    <link rel="stylesheet" href="styles.css">
</head>

<body>

    <nav class="navbar">
        <div class="brand-logo">
            <svg width="24" height="24" fill="none" class="text-white" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M19.428 15.428a2 2 0 00-1.022-.547l-2.384-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z" />
            </svg>
            FRESH CORRIDOR
        </div>
        <div class="nav-tabs">
            <div class="nav-tab active" onclick="switchTab('urban', this)">Urban Nexus</div>
            <div class="nav-tab" onclick="switchTab('health', this)">Health Monitor</div>
            <div class="nav-tab" onclick="switchTab('agri', this)">Agri-Logistics</div>
            <div class="nav-tab" onclick="switchTab('citizen', this)">Citizen Connect</div>
        </div>
        <div class="weather-widget">
            <span>New Delhi</span> | <strong>28°C</strong>
        </div>
    </nav>

    <div class="container">

        <!-- Tab 1: Urban Nexus (Cesium) -->
        <div id="urban" class="tab-content active">
            <div style="display:flex; justify-content:space-between; margin-bottom:1.5rem; align-items:center;">
                <h2 style="margin:0;">Urban Digital Twin</h2>
                <div style="font-size:0.9rem; color:var(--text-muted);">Real-time simulation environment</div>
            </div>
            <div class="card" style="padding:0; border:none; height:600px;">
                <div id="cesiumContainer"></div>
                <!-- Overlay Simulation Controls -->
                <!-- Urban Control Center Overlay -->
                <div class="urban-control-center"
                    style="position: absolute; top: 20px; left: 20px; background: rgba(255,255,255,0.95); border-radius: 12px; width: 380px; box-shadow: 0 8px 24px rgba(0,0,0,0.2); z-index: 999; display: flex; flex-direction: column; overflow: hidden; max-height: 85vh;">

                    <!-- Header -->
                    <div style="padding: 1rem; background: var(--primary-color); color: white;">
                        <h3 style="margin:0; font-size:1.1rem;">Urban Control Center</h3>
                        <div style="font-size:0.8rem; opacity:0.9;">Simulation & Monitoring</div>
                    </div>

                    <!-- Tabs -->
                    <div style="display:flex; background:#f1f5f9; border-bottom:1px solid #e2e8f0;">
                        <button class="uc-tab active" onclick="switchUrbanTab('uc-weather', this)">Weather</button>
                        <button class="uc-tab" onclick="switchUrbanTab('uc-aqi', this)">AQI</button>
                        <button class="uc-tab" onclick="switchUrbanTab('uc-market', this)">Market</button>
                        <button class="uc-tab" onclick="switchUrbanTab('uc-health', this)">Health</button>
                    </div>

                    <!-- Content Area -->
                    <div style="flex:1; overflow-y:auto; padding:1rem;">

                        <!-- 1. WEATHER TAB -->
                        <div id="uc-weather" class="uc-content active">
                            <h4 style="margin-top:0;">Weather Conditions</h4>
                            <div class="sim-card">
                                <label>Current Condition</label>
                                <select id="sim-weather-type" class="form-select">
                                    <option value="clear">Clear Sky</option>
                                    <option value="rain">Heavy Rainfall (50mm/hr)</option>
                                    <option value="heat">Heatwave (>45°C)</option>
                                    <option value="storm">Dust Storm</option>
                                </select>
                            </div>
                            <button class="btn-primary full-width" onclick="runSimulation('weather')">Simulate
                                Impact</button>
                            <div id="res-weather" class="sim-result" style="display:none;"></div>
                        </div>

                        <!-- 2. AQI TAB -->
                        <div id="uc-aqi" class="uc-content">
                            <h4 style="margin-top:0;">Air Quality Monitor</h4>
                            <div id="uc-aqi-list" class="mini-list">Loading stations...</div>

                            <hr style="margin:1rem 0; border:0; border-top:1px solid #eee;">

                            <h4 style="margin-top:0;">Simulation</h4>
                            <div class="sim-card">
                                <label>Simulate PM2.5 Spike</label>
                                <input type="range" id="sim-aqi-slider" min="50" max="500" value="100" class="slider"
                                    oninput="document.getElementById('sim-aqi-val').innerText = this.value">
                                <div style="text-align:right; font-weight:bold; color:var(--primary-color);">Level:
                                    <span id="sim-aqi-val">100</span>
                                </div>
                            </div>
                            <button class="btn-primary full-width" onclick="runSimulation('aqi')">Simulate Health
                                Impact</button>
                            <div id="res-aqi" class="sim-result" style="display:none;"></div>
                        </div>

                        <!-- 3. MARKET TAB -->
                        <div id="uc-market" class="uc-content">
                            <h4 style="margin-top:0;">Agri-Market Pulse</h4>
                            <div id="uc-market-list" class="mini-list">Loading market data...</div>

                            <hr style="margin:1rem 0; border:0; border-top:1px solid #eee;">

                            <h4 style="margin-top:0;">Supply Chain Simulation</h4>
                            <div class="sim-card">
                                <label>Event Scenario</label>
                                <select id="sim-market-event" class="form-select">
                                    <option value="normal">Normal Operations</option>
                                    <option value="blockade">Transport Strike (Supply -40%)</option>
                                    <option value="spoilage">Mass Spoilage (Loss -25%)</option>
                                </select>
                            </div>
                            <button class="btn-primary full-width" onclick="runSimulation('market')">Simulate Price
                                Impact</button>
                            <div id="res-market" class="sim-result" style="display:none;"></div>
                        </div>

                        <!-- 4. HEALTH TAB -->
                        <div id="uc-health" class="uc-content">
                            <h4 style="margin-top:0;">Hospital Grid</h4>
                            <div id="uc-health-list" class="mini-list">Loading hospitals...</div>

                            <hr style="margin:1rem 0; border:0; border-top:1px solid #eee;">

                            <h4 style="margin-top:0;">Emergency Simulation</h4>
                            <div class="sim-card">
                                <label>Emergency Type</label>
                                <select id="sim-health-event" class="form-select">
                                    <option value="normal">Normal Flow</option>
                                    <option value="surge">Epidemic Surge (Load +30%)</option>
                                    <option value="accident">Mass Casualty Event</option>
                                </select>
                            </div>
                            <button class="btn-primary full-width" onclick="runSimulation('health')">Simulate Network
                                Load</button>
                            <div id="res-health" class="sim-result" style="display:none;"></div>
                        </div>

                    </div>
                </div>
            </div>
        </div>

        <!-- Tab 2: Health Monitor -->
        <div id="health" class="tab-content">
            <div style="display:flex; justify-content:space-between; margin-bottom:1.5rem; align-items:center;">
                <h2 style="margin:0;">Public Health Overview</h2>
                <button class="btn-primary" onclick="loadHealthData()">Refresh Data</button>
            </div>

            <div class="dashboard-grid">
                <div class="card">
                    <div class="stat-indicator" style="background: var(--danger-color);"></div>
                    <h3>ICU Occupancy</h3>
                    <div class="stat-value" style="color: var(--danger-color);" id="icu-total">--</div>
                    <div class="stat-label">Critical Care Beds</div>
                </div>
                <div class="card">
                    <div class="stat-indicator" style="background: var(--success-color);"></div>
                    <h3>General Ward</h3>
                    <div class="stat-value" style="color: var(--success-color);" id="general-total">--</div>
                    <div class="stat-label">Standard Beds</div>
                </div>
                <div class="card">
                    <div class="stat-indicator" style="background: var(--warning-color);"></div>
                    <h3>Avg Oxygen Supply</h3>
                    <div class="stat-value" style="color: var(--warning-color);" id="oxygen-avg">--</div>
                    <div class="stat-label">Stock Availability</div>
                </div>
            </div>

            <div class="dashboard-grid">
                <div class="card">
                    <h3>Epidemiological Heatmap Data</h3>
                    <div id="epi-list" style="max-height: 300px; overflow-y: auto;">Loading...</div>
                </div>
                <div class="card">
                    <h3>Health Desert Alerts</h3>
                    <div id="desert-alerts">Scanning...</div>
                </div>
            </div>

            <div class="card">
                <h3>Hospital Network Status</h3>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Hospital Name</th>
                                <th>Zone</th>
                                <th>ICU Load</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody id="hospital-table"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Tab 3: Agri Logistics -->
        <div id="agri" class="tab-content">
            <div style="display:flex; justify-content:space-between; margin-bottom:1.5rem; align-items:center;">
                <h2 style="margin:0;">Agri-Logistics Network</h2>
                <button class="btn-primary" onclick="loadAgriData()">Sync Logistics</button>
            </div>

            <div class="dashboard-grid">
                <div class="card">
                    <div class="stat-indicator" style="background: #16a34a;"></div>
                    <h3>Active Shipments</h3>
                    <div class="stat-value" style="color: #16a34a;" id="agri-count">--</div>
                    <div class="stat-label">In Transit</div>
                </div>
                <div class="card">
                    <div class="stat-indicator" style="background: #ea580c;"></div>
                    <h3>Spoilage Risk</h3>
                    <div class="stat-value" style="color: #ea580c;" id="spoilage-risk">--</div>
                    <div class="stat-label">High Risk Shipments</div>
                </div>
            </div>

            <div class="card">
                <h3>Incoming Supply Log</h3>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Crop</th>
                                <th>Farmer</th>
                                <th>Origin</th>
                                <th>Quantity</th>
                                <th>Risk Score</th>
                            </tr>
                        </thead>
                        <tbody id="agri-table"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Tab 4: Citizen -->
        <div id="citizen" class="tab-content">
            <h2 style="margin-bottom:1.5rem;">Citizen Connect Pulse</h2>
            <div class="dashboard-grid">
                <div class="card">
                    <h3>My Safety Score</h3>
                    <div style="text-align:center; padding:1rem;">
                        <div style="font-size:3rem; font-weight:800; color:#0d9488;">92</div>
                        <div style="color:#0f766e; font-weight:600;">EXCELLENT</div>
                        <p style="font-size:0.9rem; color:#666;">Based on AQI, Food Access, and Safety Reports in your
                            zone.</p>
                    </div>
                </div>
                <div class="card">
                    <h3>Top AQI Hotspots</h3>
                    <div id="aqi-hotspots-list" style="min-height: 100px;">Loading hotspots...</div>
                </div>
                <div class="card">
                    <h3>Recent Community Reports</h3>
                    <div id="citizen-reports">Loading...</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Station Detail Modal -->
    <div id="station-modal" class="modal-overlay">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal()">&times;</span>
            <h2 id="modal-station-name" style="margin-top:0;">Station Details</h2>
            <div id="modal-station-location" style="color:var(--text-muted); margin-bottom:1rem;">Location</div>

            <div
                style="display:flex; align-items:center; gap:1rem; margin-bottom:2rem; background:#f8fafc; padding:1.5rem; border-radius:12px;">
                <div>
                    <div style="font-size:0.9rem; font-weight:600; color:var(--text-muted);">AQI INDEX</div>
                    <div id="modal-aqi" style="font-size:2.5rem; font-weight:800;">--</div>
                </div>
                <div style="flex:1; border-left:2px solid #e2e8f0; padding-left:1.5rem;">
                    <div style="font-size:0.9rem; font-weight:600; color:var(--text-muted);">PREDOMINANT</div>
                    <div id="modal-predominant" style="font-size:1.5rem; font-weight:700; color:var(--primary-color);">
                        --</div>
                </div>
            </div>

            <h3 style="font-size:1rem;">Pollutant Breakdown</h3>
            <div id="modal-pollutants" class="pollutant-grid">
                <!-- details injected here -->
            </div>
            <div style="margin-top: 1.5rem; font-size: 0.8rem; color: #ccc; text-align: right;" id="modal-updated">
            </div>
        </div>
    </div>

    <!-- Custom JS -->
    <script>
        function switchTab(tabId, el) {
            document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
            if (el) el.classList.add('active');

            if (tabId === 'urban') { setTimeout(initCesium, 100); if (window.loadUrbanData) window.loadUrbanData(); }
            if (tabId === 'health') loadHealthData();
            if (tabId === 'agri') loadAgriData();
            if (tabId === 'citizen') loadCitizenData();
        }
    </script>
    <script src="app.js"></script>
</body>

</html>